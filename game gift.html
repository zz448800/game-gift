<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§è±¬2025å¹´æœ«æœ‰çå¾µç­”ï¼</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è¨­å®šå­—é«”ç‚º Inter */
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }

        /* æ…¶ç¥èƒŒæ™¯åœ–æ¡ˆ (ä½¿ç”¨ä½¿ç”¨è€…æä¾›çš„åœ–ç‰‡) */
        .celebration-bg {
            background-image: url('birthday_background.jpg'); /* èƒŒæ™¯åœ–ç‰‡ï¼šè«‹ç¢ºä¿æª”æ¡ˆå­˜åœ¨ */
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-color: #BEE3F8; /* æ·ºè—è‰² */
        }

        /* è‡ªå®šç¾©å‹•ç•«ï¼šç¦®ç‰©ç›’æ–æ™ƒã€æ‰“é–‹ã€ç™¼å…‰ */
        @keyframes jiggle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.05) rotate(2deg); }
            75% { transform: scale(1.05) rotate(-2deg); }
        }

        @keyframes openAndGlow {
            0% { transform: scale(1); opacity: 1; box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
            50% { transform: scale(1.1); opacity: 1; box-shadow: 0 0 40px rgba(255, 255, 0, 0.8); }
            100% { transform: scale(1); opacity: 0; }
        }

        /* ç¦®ç‰©ç›’çˆ†ç‚¸å‹•ç•« */
        @keyframes explosion {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            100% { transform: scale(2) rotate(30deg); opacity: 0; } /* çˆ†ç‚¸å¾Œæ¶ˆå¤± */
        }

        /* æœ€å¾Œç¦®ç‰©å¼·å…‰å‹•ç•« */
        @keyframes strongGlow {
            0% { box-shadow: 0 0 0 rgba(255, 255, 255, 0); }
            50% { box-shadow: 0 0 80px 30px rgba(255, 255, 100, 1); }
            100% { box-shadow: 0 0 0 rgba(255, 255, 255, 0); }
        }

        /* æ–‡å­—é€å­—æ’­æ”¾å‹•ç•« */
        .typewriter-text {
            border-right: .15em solid #FCD34D; /* æ¨¡æ“¬æ‰“å­—æ©Ÿå…‰æ¨™ - ç¥ç€è‰² */
            white-space: pre-wrap; /* å…è¨±æ›è¡Œ */
            overflow: hidden; /* éš±è—è¶…å‡ºå¯¬åº¦çš„æ–‡å­— */
        }

        /* éš±è—å…ƒç´  */
        .hidden-item {
            display: none;
        }

        /* å…§å®¹æ¨£å¼ */
        .gift-media {
            max-width: 90%;
            height: auto;
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease-in-out;
            margin-bottom: 1rem;
        }
        video.gift-media {
            width: 100%;
            max-height: 50vh;
            object-fit: cover;
        }

        /* æŒ‰éˆ•åŸºç¤æ¨£å¼ */
        .piggy-button {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: bold;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .piggy-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }

        /* å•ç­”é¸é …æ¨£å¼ (é–“è·ä¿®æ­£ - æ›´ç·Šè²¼åˆ°æ¥µé™) */
        .quiz-option {
            display: flex;
            align-items: center;
            padding: 0.25rem 0.5rem; /* ä¸Šä¸‹å…§è·é€²ä¸€æ­¥æ¸›å°‘ */
            margin-bottom: 0.125rem; /* é¸é …é–“è·é€²ä¸€æ­¥æ¸›å°‘ */
            border-radius: 0.75rem;
            background-color: #FFFBEB; /* æ·ºé»ƒè‰²/å¥¶æ²¹è‰² */
            cursor: pointer;
            transition: background-color 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .quiz-option:hover {
            background-color: #FCD34D; /* è¼ƒæ·±çš„ç¥ç€è‰² */
        }
        .quiz-option input[type="radio"] {
            margin-right: 1rem;
            transform: scale(1.5);
            accent-color: #F59E0B; /* ç¥ç€ä¸»é¡Œè‰² */
        }
        .text-cute-shadow {
             text-shadow: 2px 2px 0px #FCD34D; /* æ·ºç¥ç€è‰²é™°å½± */
             color: #D97706; /* æ·±ç¥ç€è‰²æ–‡å­— */
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-4 celebration-bg">

    <!-- ä¸»éŠæˆ²å®¹å™¨ -->
    <div id="game-container" class="w-full max-w-lg bg-white/95 backdrop-blur-sm p-8 md:p-10 rounded-3xl shadow-2xl text-center min-h-[500px] flex flex-col justify-center items-center" 
         style="background-color: rgba(255, 255, 255, 0.98); border: 4px solid #FCD34D;"> <!-- å®¹å™¨é‚Šæ¡†æ”¹ç‚ºç¥ç€è‰² -->
        
        <!-- å…§å®¹é¡¯ç¤ºå€åŸŸ -->
        <div id="content-display" class="flex flex-col items-center justify-center w-full h-full space-y-6">
            <!-- éŠæˆ²å…§å®¹/å•ç­”/ç¦®ç‰©æœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
        </div>

        <!-- ç¦®ç‰©ç›’å…ƒç´  (ç”¨æ–¼å‹•ç•«å’Œé»æ“Š) -->
        <img id="gift-box-visual" 
             src="gift1.jpg" 
             alt="ç”Ÿæ—¥ç¦®ç‰©ç›’" 
             class="cursor-pointer w-48 h-48 md:w-64 md:h-64 object-contain transition-all duration-300 hidden-item" 
             onclick="handleGiftClick()">

        <!-- å‹•ä½œæŒ‰éˆ• -->
        <div id="action-area" class="mt-8">
            <!-- æŒ‰éˆ•å€ -->
        </div>

        <!-- éŒ¯èª¤è¨Šæ¯/åŠ è¼‰æŒ‡ç¤º -->
        <p id="message" class="mt-4 text-red-500 font-semibold"></p>
        <div id="loading-spinner" class="hidden-item">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500"></div> <!-- æ—‹è½‰åœˆæ”¹ç‚ºç¥ç€è‰² -->
            <p class="text-amber-600 mt-2">å°è±¬æ­£åœ¨æº–å‚™ç‰¹åˆ¥ç¦®ç‰©...</p> <!-- æ–‡å­—æ”¹ç‚ºç¥ç€è‰² -->
        </div>

    </div>

    <script>
        // === éŠæˆ²ç‹€æ…‹å®šç¾© (æ–°çµæ§‹) ===
        // 0: åˆå§‹ä»‹ç´¹ (Quiz Welcome)
        // 1: å•é¡Œ 1
        // 2: å•é¡Œ 2
        // 3: å•é¡Œ 3
        // 4: å•é¡Œ 2 (ä¸æ„›å°è±¬) ç¢ºèªç•«é¢ (Q2 failure path)
        // 5: å•é¡Œ 3 (ä¸é¡˜æ„) ç¢ºèªç•«é¢ (Q3 failure path)
        // 6: ç•«é¢ä¸€ (æ­å–œ/é€²å…¥é–‹ç®±æº–å‚™)
        // 7: ç¦®ç‰©ç›’å‡ºç¾ï¼Œç­‰å¾…é»æ“Š (Unboxing Prep)
        // 8: ç¦®ç‰© 1 (placeholder_pig)
        // 9: ç¦®ç‰© 2 (gift2)
        // 10: ç¦®ç‰© 3 (gift3)
        // 11: ç¦®ç‰© 4 (gift4)
        // 12: ç¦®ç‰© 5 (å½±ç‰‡1)
        // 13: ç¦®ç‰©çˆ†ç‚¸/éŒ¯èª¤ (placeholder_explosion)
        // 14: æœ€å¾Œç¦®ç‰© (gift5)
        // 15: æœ€çµ‚å¡ç‰‡ (é€å­—æ’­æ”¾)
        let gameState = 0;
        let currentGiftIndex = 0; // ç¦®ç‰©åºåˆ—çš„ç´¢å¼•

        const contentDisplay = document.getElementById('content-display');
        const giftBoxVisual = document.getElementById('gift-box-visual');
        const actionArea = document.getElementById('action-area');
        const message = document.getElementById('message');
        const loadingSpinner = document.getElementById('loading-spinner');

        // å®šç¾©å•ç­”é¡Œç›®
        const questions = [
            // Q1: State 1
            { 
                state: 1, 
                title: "è«‹å•ä½ æ˜¯?", 
                options: [
                    { text: "å°è±¬å°ˆå±¬ç§˜æ›¸ å¤§è±¬", isCorrect: true },
                    { text: "è”¡å³æé¾", isCorrect: false },
                    { text: "è¶…ç´šå¤§å¸¥å“¥", isCorrect: false },
                ] 
            },
            // Q2: State 2
            { 
                state: 2, 
                title: "ä½ æœ€æ„›çš„äººæ˜¯?", 
                options: [
                    { text: "å°è±¬ç¸½è£" },
                    { text: "IU" },
                    { text: "æˆ‘æ²’æœ‰æœ€æ„›çš„äºº æˆ‘æ²’æœ‰æ„›å°è±¬" },
                ] 
            },
            // Q3: State 3
            { 
                state: 3, 
                title: "ä½ é¡˜æ„å°å°è±¬å¥½ï¼Œå¿ èª ä¸æ¬ºé¨™ä¸éš±çï¼ŒçœŸå¿ƒçš„æ„›å°è±¬å—", 
                options: [
                    { text: "æˆ‘é¡˜æ„" },
                    { text: "æˆ‘ä¸é¡˜æ„" },
                ] 
            },
        ];

        // ç¦®ç‰©åºåˆ— (å°æ‡‰ç‹€æ…‹ 8 åˆ° 14)
        const giftSequence = [
            { id: 1, img: "placeholder_pig.jpg", title: "æ­å–œä½ ç²å¾—!", text: "çµ‚èº«ã„…ã„§ã„¤Ë‹ã„…ã„§ã„¤Ë‹è±¬è±¬ç", nextBtnText: "æ”¾ä¸‹ä¸€å€‹ç¦®ç‰©ç›’", nextState: 7 }, // ç¦®ç‰© 1 (placeholder_pig ä½”ä½ç¬¦)
            { id: 2, img: "gift2.jpg", title: "æ­å–œä½ ç²å¾—!", text: "ç”Ÿæ—¥è›‹ç³•å…Œæ›å·", nextBtnText: "æ”¾ä¸‹ä¸€å€‹ç¦®ç‰©ç›’", nextState: 7 }, // **Reverted: Added "ç”Ÿæ—¥"**
            { id: 3, img: "gift3.jpg", title: "æ­å–œä½ ç²å¾—!", text: "ä¿æš–å¥—è£ (è¨˜å¾—å‘Šè¨´å°è±¬ä½ å–œæ­¡çš„é¡è‰²å–”)", nextBtnText: "æ”¾ä¸‹ä¸€å€‹ç¦®ç‰©ç›’", nextState: 7 }, // ç¦®ç‰© 3 (gift3)
            { id: 4, img: "gift4.jpg", title: "æ­å–œä½ ç²å¾—!", text: "å¯æ„›å¥³å‹å‡ºé“ç…§ä¸€å¼µ", nextBtnText: "æ”¾ä¸‹ä¸€å€‹ç¦®ç‰©ç›’", nextState: 7 }, // ç¦®ç‰© 4 (gift4)
            { id: 5, img: "my_birthday_video.mp4", title: "æ­å–œä½ ç²å¾—!", text: "å°è±¬å”±çµ¦ä½ è½", nextBtnText: "æ”¾ä¸‹ä¸€å€‹ç¦®ç‰©ç›’", nextState: 7 }, // ç¦®ç‰© 5 (å½±ç‰‡1)
            { id: 6, img: "placeholder_explosion.jpg", title: "ğŸ’¥ ç¦®ç‰©çˆ†ç‚¸! ğŸ’¥", text: "é˜¿ä¸å¿ƒçµ¦éŒ¯æ±è¥¿å“ˆå“ˆï¼Œå†é–‹ä¸€æ¬¡", nextBtnText: "å†é–‹ä¸€æ¬¡ï¼", nextState: 14, isExplosion: true }, // ç¦®ç‰© 6 (placeholder_explosion ä½”ä½ç¬¦/çˆ†ç‚¸)
            { id: 7, img: "gift5.png", title: "é€™æ˜¯â€¦.!!!!!!!!!", text: "æ­å–œä½ ç²å¾—æœ€å¤§ç: DJI pocket3ä¸€å¥—\n\nä½ å¸¶å°è±¬ç‘å£«è¡Œï¼Œå°è±¬å¹«ä½ å…¨éƒ¨è¨˜éŒ„èµ·ä¾†", nextBtnText: "ä½ å–œæ­¡é€™äº›ç¦®ç‰©å—?", nextState: 15 }, // ç¦®ç‰© 7 (gift5 / æœ€çµ‚ç)
        ];

        // å¡ç‰‡å…§å®¹
        const cardText = `çµ¦å¤§è±¬:

æœ‰æ²’æœ‰å–œæ­¡æˆ‘çš„é©šå–œå‘€ï¼Œé€™æ˜¯æˆ‘å€‘ç›¸è™•çš„ç¬¬äºŒå€‹ç”Ÿæ—¥ï¼Œé›–ç„¶åˆæ˜¯ä¸èƒ½é™ªåœ¨èº«é‚Šçš„ä¸€å¹´ï¼Œä½†é‚„æ˜¯è¦è®“ä½ æ„Ÿè¦ºé–‹å¿ƒã€‚ä½ å¹«æˆ‘å‡ºæ©Ÿç¥¨æˆ‘è²·ç›¸æ©Ÿçµ¦ä½ ï¼Œè¦è¨˜éŒ„æˆ‘å€‘ä¸€èµ·å»å¥½å¤šå¥½å¤šåœ°æ–¹ç©ï¼Œè¦å»ç’°éŠå…¨ä¸–ç•Œ!
è¬è¬ä½ åœ¨æˆ‘éœ€è¦çš„æ™‚å€™é™ªåœ¨æˆ‘èº«é‚Šï¼Œçµ¦æˆ‘å»ºè­°è½æˆ‘ç™¼ä¸‹ï¼Œé›–ç„¶æœ‰æ™‚å€™åœ¨ç£¨åˆæƒ³æ³•å¯èƒ½ä¸ä¸€æ¨£ï¼Œä½†æˆ‘å€‘è¦è¶Šä¾†è¶Šå¥½å•¦ï¼Œå¸Œæœ›æˆ‘å€‘èƒ½æˆç‚ºå½¼æ­¤æœ€ä½³æ‹æª”
26æ­²äº†ç”Ÿæ—¥å¿«æ¨‚è¦æ›´æ„›å°è±¬å°å°è±¬æ›´å¥½å–”ï¼Œæ„›ä½ å–”ï¼Œæˆ‘æ„›ä½ `; // **Reverted: Added "ç¬¬äºŒå€‹ç”Ÿæ—¥" and "ç”Ÿæ—¥å¿«æ¨‚"**

        // === è¼”åŠ©å‡½æ•¸ ===

        /**
         * é¡¯ç¤ºå…§å®¹å¡ç‰‡ (é€šç”¨æ–¼ä»‹ç´¹ã€ç¦®ç‰©å…§å®¹ã€ç¢ºèªç•«é¢)
         */
        function showContentCard(title, bodyHtml, mediaUrl = null, stateClass = 'bg-amber-50/80') {
            let mediaHtml = '';
            if (mediaUrl) {
                const isVideo = mediaUrl.toLowerCase().endsWith('.mp4') || mediaUrl.toLowerCase().endsWith('.mov');
                
                if (isVideo) {
                    // ä½¿ç”¨ alert() ä¾†æ¨¡æ“¬éŒ¯èª¤ï¼Œå› ç‚ºæ­¤è™•ä¸èƒ½ä½¿ç”¨ navigator.clipboard
                    mediaHtml = `<video src="${mediaUrl}" controls loop autoplay muted class="gift-media mb-4 mx-auto" onerror="this.onerror=null; this.src='https://placehold.co/400x300/FFFBEB/D97706?text=å½±ç‰‡è¼‰å…¥å¤±æ•—'; alert('å½±ç‰‡è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆåç¨±æ˜¯å¦ç‚º my_birthday_video.mp4');" alt="é©šå–œå½±ç‰‡"></video>`;
                } else {
                    mediaHtml = `<img src="${mediaUrl}" class="gift-media mx-auto" alt="å…§å®¹åœ–ç‰‡" onerror="this.onerror=null; this.src='https://placehold.co/400x300/FFFBEB/D97706?text=åœ–ç‰‡è¼‰å…¥å¤±æ•—';">`;
                }
            }

            contentDisplay.innerHTML = `
                <div class="w-full p-4 md:p-6 ${stateClass} rounded-2xl shadow-xl transition-all duration-500 transform scale-100">
                    <p class="text-3xl md:text-4xl font-black mb-4 block text-cute-shadow">${title}</p>
                    ${mediaHtml}
                    <div class="text-xl md:text-2xl font-extrabold text-indigo-700 leading-relaxed whitespace-pre-wrap">${bodyHtml}</div>
                </div>
            `;
            giftBoxVisual.classList.add('hidden-item');
            actionArea.innerHTML = '';
            message.textContent = '';
            loadingSpinner.classList.add('hidden-item');
        }

        /**
         * é¡¯ç¤ºå•ç­”ç•«é¢
         */
        function showQuiz(question) {
            let optionsHtml = '';
            question.options.forEach((option, index) => {
                optionsHtml += `
                    <label class="quiz-option text-left text-gray-700">
                        <input type="radio" name="quiz-option" value="${index}" class="form-radio text-amber-500">
                        <span class="text-lg font-medium">${option.text}</span>
                    </label>
                `;
            });

            showContentCard(question.title, `
                <form id="quiz-form" class="mt-4 w-full">
                    ${optionsHtml}
                </form>
            `, null, 'bg-amber-100/80'); // èƒŒæ™¯æ”¹ç‚ºæ·ºç¥ç€è‰²

            // æ·»åŠ æäº¤æŒ‰éˆ•
            const submitBtn = document.createElement('button');
            submitBtn.className = 'piggy-button bg-amber-600 hover:bg-amber-700 text-white shadow-lg mt-4'; // æŒ‰éˆ•æ”¹ç‚ºç¥ç€è‰²
            submitBtn.textContent = 'ç¢ºå®šé€å‡º';
            submitBtn.onclick = () => handleQuizSubmit(question.state);
            actionArea.appendChild(submitBtn);
        }

        /**
         * è™•ç†å•ç­”æäº¤ (å·²ä¾æ“šä½¿ç”¨è€…è¦æ±‚ä¿®æ­£ Q1 å’Œ Q2 çš„é‚è¼¯)
         */
        function handleQuizSubmit(questionState) {
            const form = document.getElementById('quiz-form');
            const selectedOption = form.querySelector('input[name="quiz-option"]:checked');

            if (!selectedOption) {
                message.textContent = 'è«‹é¸æ“‡ä¸€å€‹é¸é …ï¼';
                return;
            }

            const selectedIndex = parseInt(selectedOption.value);
            let nextState = questionState; // é è¨­ç•™åœ¨åŸåœ°

            if (questionState === 1) {
                // Q1: å¿…é ˆé¸ç¬¬ä¸€å€‹
                if (selectedIndex === 0) {
                    nextState = 2; // æ­£ç¢º: è·³åˆ° Q2
                } else {
                    // éŒ¯èª¤: ä¿æŒåœ¨ Q1, é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
                    message.textContent = 'ä½ ç­”éŒ¯äº†ï¼è«‹é¸æ­£ç¢ºçš„ç­”æ¡ˆã€‚';
                    return; // åœç•™åœ¨ç•¶å‰ç‹€æ…‹
                }
            } else if (questionState === 2) {
                // Q2: 
                if (selectedIndex === 0) {
                    nextState = 3; // æ­£ç¢º: è·³åˆ° Q3
                } else if (selectedIndex === 1) {
                    // é¸ IU: é¡¯ç¤ºä½ ç¢ºå®šå—, ä¿æŒåœ¨ Q2
                    message.textContent = 'ä½ ç¢ºå®šå—? è«‹å†æƒ³ä¸€æƒ³ã€‚';
                    return; // åœç•™åœ¨ç•¶å‰ç‹€æ…‹
                } else if (selectedIndex === 2) {
                    nextState = 4; // é¸ä¸æ„›: è·³åˆ°ç¢ºèªç•«é¢ (State 4)
                }
            } else if (questionState === 3) {
                // Q3: é¸ 0 è·³åˆ°æ­å–œ (State 6)ï¼Œé¸ 1 è·³åˆ°ç¢ºèª (State 5)
                nextState = (selectedIndex === 0) ? 6 : 5;
            }

            updateGame(nextState);
        }

        /**
         * è™•ç†ç¢ºèªç•«é¢ (Q2/Q3 å¤±æ•—è·¯å¾‘) çš„æŒ‰éˆ•é»æ“Š
         * @param {number} optionIndex é»æ“Šçš„é¸é …ç´¢å¼•
         * @param {number} backToQState é»æ“Šã€Œå°æˆ‘ä¸æ„›ã€æ™‚è¦è·³å›çš„é¡Œç›®ç‹€æ…‹ (Q2æˆ–Q3)
         * @param {number} successState é»æ“Šã€Œé¨™ä½ çš„ æˆ‘æ„›ã€æ™‚è¦è·³å¾€çš„é¡Œç›®ç‹€æ…‹ (Q3)
         */
        function handleConfirmationSubmit(optionIndex, backToQState, successState) {
            if (optionIndex === 0) {
                // é¸é …ä¸€: é¨™ä½ çš„ æˆ‘æ„›å°è±¬æ‹‰ (è·³åˆ°ä¸‹ä¸€é¡Œ Q3)
                updateGame(successState);
            } else if (optionIndex === 1) {
                // é¸é …äºŒ: å°æˆ‘ä¸æ„›å°è±¬ (è­¦å‘Šä¸¦è·³å› Q2/Q3)
                message.textContent = 'âš ï¸ è­¦å‘Šçª—å£ï¼šæˆ‘å†çµ¦ä½ ä¸€æ¬¡æ©Ÿæœƒï¼è«‹çœŸå¿ƒå›ç­”ã€‚';
                
                // æ¨¡æ“¬è­¦å‘Šå»¶é²å¾Œè·³è½‰
                setTimeout(() => {
                    updateGame(backToQState);
                }, 1500); 
            }
        }

        /**
         * é¡¯ç¤ºç¦®ç‰©ç›’ï¼Œæº–å‚™é»æ“Š (State 7)
         */
        function showGiftBoxPrep() {
            contentDisplay.innerHTML = '';
            // ç¢ºä¿ç¦®ç‰©ç›’é‡è¨­ä¸¦å¯è¦‹
            giftBoxVisual.classList.remove('hidden-item');
            giftBoxVisual.style.animation = 'none';
            giftBoxVisual.style.transform = 'scale(1) rotate(0deg)';
            giftBoxVisual.style.opacity = '1';
            void giftBoxVisual.offsetWidth; 

            actionArea.innerHTML = '';
            message.textContent = 'å½ˆè·³å‡ºä¸€å€‹ç¦®ç‰©ç›’ï¼Œé»æ“Šå®ƒä¾†é–‹ç®±ï¼';
        }

        /**
         * è™•ç†ç¦®ç‰©ç›’é»æ“Šäº‹ä»¶
         */
        function handleGiftClick() {
            if (gameState !== 7) return;

            message.textContent = 'ç¦®ç‰©æ­£åœ¨æ‰“é–‹ä¸­...';
            giftBoxVisual.style.cursor = 'default';
            
            // 1. å½ˆè·³å…©ä¸‹ (jiggle)
            giftBoxVisual.style.animation = 'jiggle 0.5s ease-in-out 2';

            setTimeout(() => {
                // 2. æ‰“é–‹ç™¼å…‰ (open and glow)
                giftBoxVisual.style.animation = 'openAndGlow 0.8s forwards';

                setTimeout(() => {
                    // 3. é€²å…¥ç•¶å‰ç¦®ç‰©ç‹€æ…‹ (æ ¹æ“š currentGiftIndex)
                    const targetGift = giftSequence[currentGiftIndex];
                    if (!targetGift) {
                         message.textContent = 'éŠæˆ²çµæŸï¼';
                         return;
                    }
                    
                    if (targetGift.isExplosion) {
                         // çˆ†ç‚¸æ˜¯ç‰¹æ®Šç‹€æ…‹ï¼Œç›´æ¥é€²å…¥ state 13
                         updateGame(13);
                    } else {
                        // ä¸€èˆ¬ç¦®ç‰©ç‹€æ…‹ (8, 9, 10, 11, 12, 14)
                        // æ³¨æ„ï¼šé€™è£¡ 8 + currentGiftIndex æœƒæ˜¯ 8-12ï¼Œä¸æœƒåˆ° 14ï¼Œ14 æ˜¯é€šé handleFinalAnimationTrigger é€²å…¥
                        updateGame(8 + currentGiftIndex); 
                    }
                    giftBoxVisual.style.cursor = 'pointer';
                }, 800);
            }, 1000); 
        }

        /**
         * è™•ç†é–‹ç®±å¾Œçš„ä¸‹ä¸€æ­¥æŒ‰éˆ• (æ”¾/å†é–‹ä¸€å€‹ç¦®ç‰©ç›’)
         */
        function handleNextGiftStep(nextState) {
             // åªæœ‰åœ¨ Gift ç‹€æ…‹ (8-14) æ‰èƒ½ä½¿ç”¨
            if (gameState >= 8 && gameState <= 14) {
                
                if (nextState === 7) {
                    currentGiftIndex++; // ç§»å‹•åˆ°ä¸‹ä¸€å€‹ç¦®ç‰©
                    // ç¹¼çºŒé–‹ç®±: å›åˆ°ç¦®ç‰©ç›’ç­‰å¾…é»æ“Šç‹€æ…‹
                    updateGame(7); 
                } else if (nextState === 15) {
                    // æœ€çµ‚å¡ç‰‡
                    updateGame(15);
                }
            }
        }

        /**
         * æ’­æ”¾å¡ç‰‡æ–‡å­—é€å­—æ•ˆæœ (å·²ç§»é™¤æ¨™é¡Œ)
         */
        function typeText(text) {
            // ç§»é™¤æ¨™é¡Œï¼Œä¸¦èª¿æ•´å®¹å™¨å°é½Šæ–¹å¼ç‚ºå·¦ä¸Šè§’
            contentDisplay.innerHTML = `
                <div class="w-full p-6 bg-amber-50/90 rounded-2xl shadow-xl border-4 border-amber-300 transition-all duration-500 transform scale-100 min-h-[300px] flex flex-col items-start text-left">
                    <pre id="typewriter" class="typewriter-text text-xl font-extrabold text-amber-700 leading-relaxed max-w-full overflow-hidden w-full pt-2"></pre>
                </div>
            `;
            const typewriter = document.getElementById('typewriter');
            let i = 0;
            const speed = 75; // æ¯å€‹å­— 75ms (æ”¾æ…¢é€Ÿåº¦)

            function type() {
                if (i < text.length) {
                    // è™•ç†æ›è¡Œï¼Œpre æ¨™ç±¤æœƒä¿æŒæ ¼å¼
                    typewriter.textContent += text.charAt(i); 
                    i++;
                    setTimeout(type, speed);
                } else {
                    typewriter.style.borderRight = 'none';
                    message.textContent = 'ğŸ¥³ éŠæˆ²çµæŸï¼æ°¸é æ„›ä½ ï¼ ğŸ¥³';
                    message.classList.remove('text-red-500');
                    message.classList.add('text-amber-600', 'text-2xl'); // è¨Šæ¯æ–‡å­—æ”¹ç‚ºç¥ç€è‰²
                }
            }
            type();
        }

        // === éŠæˆ²é‚è¼¯æ§åˆ¶ä¸­å¿ƒ ===

        /**
         * æ›´æ–°éŠæˆ²ç•«é¢å’Œç‹€æ…‹
         * @param {number} newState ç›®æ¨™ç‹€æ…‹
         */
        function updateGame(newState) {
            gameState = newState;
            actionArea.innerHTML = '';
            message.textContent = '';
            
            switch (gameState) {
                // --- æ¸¬é©—éšæ®µ ---
                case 0:
                    // åˆå§‹ä»‹ç´¹ (Quiz Welcome)
                    showContentCard(
                        "æ­¡è¿ä¾†åˆ° 2025 è±¬è±¬æœƒç¤¾ å¹´æœ«æœ‰çå¾µç­”", // **Reverted: Added "ç”Ÿæ—¥"**
                        "ç­”å°å…¨éƒ¨å°±å¯ä»¥ç²å¾—ç²¾ç¾å¤§çå–”ï¼",
                        null,
                        'bg-amber-100/80' // èƒŒæ™¯æ”¹ç‚ºæ·ºç¥ç€è‰²
                    );
                    const startBtn = document.createElement('button');
                    startBtn.className = 'piggy-button bg-amber-600 hover:bg-amber-700 text-white shadow-lg'; // æŒ‰éˆ•æ”¹ç‚ºç¥ç€è‰²
                    startBtn.textContent = 'é–‹å§‹ç­”é¡Œ';
                    startBtn.onclick = () => updateGame(1);
                    actionArea.appendChild(startBtn);
                    break;
                case 1:
                    showQuiz(questions[0]); // Q1
                    break;
                case 2:
                    showQuiz(questions[1]); // Q2
                    break;
                case 3:
                    showQuiz(questions[2]); // Q3
                    break;
                
                // Q2 å¤±æ•—ç¢ºèªç•«é¢ (State 4)
                case 4:
                    showContentCard(
                        "ä½ çœŸçš„ä¸æ„›å°è±¬å—?",
                        "è«‹ç¢ºèªä½ çš„å¿ƒæ„ã€‚",
                        null,
                        'bg-red-100/80' // è­¦å‘Šç•«é¢ä¿ç•™ç´…è‰²ç³»
                    );
                    const btn4_1 = document.createElement('button');
                    btn4_1.className = 'piggy-button bg-green-500 hover:bg-green-600 text-white shadow-lg mr-4';
                    btn4_1.textContent = 'é¨™ä½ çš„ æˆ‘æ„›å°è±¬æ‹‰';
                    btn4_1.onclick = () => handleConfirmationSubmit(0, 2, 3); // æˆåŠŸè·³ Q3 (State 3)
                    actionArea.appendChild(btn4_1);

                    const btn4_2 = document.createElement('button');
                    btn4_2.className = 'piggy-button bg-orange-800 hover:bg-orange-900 text-white shadow-lg'; // å¤±æ•—æŒ‰éˆ•æ”¹ç‚ºæ·±æ©˜è‰²
                    btn4_2.textContent = 'å°æˆ‘ä¸æ„›å°è±¬';
                    btn4_2.onclick = () => handleConfirmationSubmit(1, 2, 3); // å¤±æ•—è·³å› Q2 (State 2)
                    actionArea.appendChild(btn4_2);
                    break;

                // Q3 å¤±æ•—ç¢ºèªç•«é¢ (State 5)
                case 5:
                    showContentCard(
                        "æ‰€ä»¥ä½ ä¸æ„›å°è±¬å—?",
                        "é€™æ˜¯æœ€å¾Œçš„æ©Ÿæœƒï¼Œå¥½å¥½æƒ³æƒ³ï¼",
                        null,
                        'bg-red-100/80' // è­¦å‘Šç•«é¢ä¿ç•™ç´…è‰²ç³»
                    );
                    const btn5_1 = document.createElement('button');
                    btn5_1.className = 'piggy-button bg-green-500 hover:bg-green-600 text-white shadow-lg mr-4';
                    btn5_1.textContent = 'é¨™ä½ çš„ æˆ‘æ„›å°è±¬æ‹‰';
                    btn5_1.onclick = () => handleConfirmationSubmit(0, 2, 3); // æˆåŠŸè·³ Q3 (State 3)
                    actionArea.appendChild(btn5_1);

                    const btn5_2 = document.createElement('button');
                    btn5_2.className = 'piggy-button bg-orange-800 hover:bg-orange-900 text-white shadow-lg'; // å¤±æ•—æŒ‰éˆ•æ”¹ç‚ºæ·±æ©˜è‰²
                    btn5_2.textContent = 'å°æˆ‘ä¸æ„›å°è±¬';
                    btn5_2.onclick = () => handleConfirmationSubmit(1, 2, 3); // å¤±æ•—è·³å› Q2 (State 2)
                    actionArea.appendChild(btn5_2);
                    break;
                
                // --- æ­å–œ/é€²å…¥é–‹ç®± ---
                case 6:
                    // ç•«é¢ä¸€: æ­å–œ/æ–‡å­—é€è¡Œé¡¯ç¤º
                    contentDisplay.innerHTML = `
                        <p class="text-4xl font-black text-amber-700 text-cute-shadow mb-4 animate-bounce">ğŸ‰ æ­å–œä½ ç²å¾—å¤§è±¬å°ˆå±¬ 2025 ç”Ÿæ—¥ç¦®ç‰©! ğŸ‰</p> <!-- **Reverted: Added "ç”Ÿæ—¥"** -->
                        <div id="intro-text" class="text-xl font-medium text-gray-700 leading-loose min-h-[100px] text-center"></div>
                    `;
                    
                    const lines = [
                        "å› ç‚ºé€™ä¸€å¹´ä¾†ä½ å°å°è±¬çš„ç…§é¡§é™ªä¼´ï¼Œ",
                        "è®“è±¬è±¬å…¬å¸ç‡Ÿé‹åˆ°ç¾åœ¨ï¼Œç‰¹åˆ¥ç‚ºä½ é ’ç™¼ç‰¹åˆ¥çé …ã€‚",
                        "é‚£å°±è®“æˆ‘å€‘ä¸è¦å»¢è©±é‚£éº¼å¤š...",
                        "é–‹å§‹é–‹çå§~"
                    ];
                    let lineIndex = 0;
                    
                    function displayNextLine() {
                        if (lineIndex < lines.length) {
                            const p = document.createElement('p');
                            p.textContent = lines[lineIndex];
                            p.classList.add('opacity-0', 'transition-opacity', 'duration-1000', 'text-2xl', 'font-semibold');
                            document.getElementById('intro-text').appendChild(p);
                            setTimeout(() => { p.classList.remove('opacity-0'); }, 10); // å»¶é²é¡¯ç¤º
                            lineIndex++;
                            setTimeout(displayNextLine, 1500); // æ¯ 1.5 ç§’é¡¯ç¤ºä¸‹ä¸€è¡Œ
                        } else {
                            // æ–‡å­—é¡¯ç¤ºå®Œç•¢ï¼Œå‡ºç¾æŒ‰éˆ•
                            setTimeout(() => {
                                const nextBtn = document.createElement('button');
                                nextBtn.className = 'piggy-button bg-amber-600 hover:bg-amber-700 text-white shadow-lg mt-8'; // æŒ‰éˆ•æ”¹ç‚ºç¥ç€è‰²
                                nextBtn.textContent = 'æº–å‚™å¥½äº†ï¼';
                                nextBtn.onclick = () => updateGame(7);
                                actionArea.appendChild(nextBtn);
                            }, 1000);
                        }
                    }
                    displayNextLine();
                    break;

                // --- é–‹ç®±éšæ®µ ---
                case 7:
                    // ç¦®ç‰©ç›’å‡ºç¾ï¼Œç­‰å¾…é»æ“Š (Unboxing Prep)
                    showGiftBoxPrep();
                    break;

                case 8: // ç¦®ç‰© 1 (placeholder_pig)
                case 9: // ç¦®ç‰© 2 (gift2)
                case 10: // ç¦®ç‰© 3 (gift3)
                case 11: // ç¦®ç‰© 4 (gift4)
                case 12: { // ç¦®ç‰© 5 (å½±ç‰‡1)
                    const giftData = giftSequence[currentGiftIndex];
                    showContentCard(
                        giftData.title,
                        giftData.text,
                        giftData.img,
                        'bg-amber-100/80' // èƒŒæ™¯æ”¹ç‚ºæ·ºç¥ç€è‰²
                    );
                    
                    const nextBtn = document.createElement('button');
                    nextBtn.className = 'piggy-button bg-amber-600 hover:bg-amber-700 text-white shadow-lg mt-4'; // æŒ‰éˆ•æ”¹ç‚ºç¥ç€è‰²
                    nextBtn.textContent = giftData.nextBtnText;
                    // ä¸‹ä¸€æ­¥å›åˆ°ç¦®ç‰©ç›’ç­‰å¾…é»æ“Šç‹€æ…‹ (State 7)
                    nextBtn.onclick = () => handleNextGiftStep(giftData.nextState); 
                    actionArea.appendChild(nextBtn);
                    break;
                }
                
                case 13: {
                    // ç¦®ç‰©çˆ†ç‚¸/éŒ¯èª¤ (placeholder_explosion)
                    const giftData = giftSequence[currentGiftIndex];
                    message.textContent = 'ğŸ’¥ çˆ†ç‚¸! ğŸ’¥';
                    
                    // è®“ç¦®ç‰©ç›’è¦–è¦ºåŒ–å…ƒç´ æ¶ˆå¤± (çˆ†ç‚¸å‹•ç•«)
                    giftBoxVisual.style.animation = 'explosion 0.5s forwards';
                    giftBoxVisual.classList.add('hidden-item'); // é¡¯å¼éš±è—å®ƒï¼Œä»¥é˜²å‹•ç•«çµæŸå¾Œæ®˜ç•™

                    showContentCard(
                        giftData.title,
                        giftData.text,
                        giftData.img,
                        'bg-red-100/80'
                    );

                    // çˆ†ç‚¸å¾Œå»¶é²é‡ç½®ç¦®ç‰©ç›’ï¼Œé¡¯ç¤ºå†é–‹ä¸€æ¬¡æŒ‰éˆ•
                    setTimeout(() => {
                        const retryBtn = document.createElement('button');
                        retryBtn.className = 'piggy-button bg-amber-600 hover:bg-amber-700 text-white shadow-lg mt-4'; // æŒ‰éˆ•æ”¹ç‚ºç¥ç€è‰²
                        retryBtn.textContent = giftData.nextBtnText;
                        // é»æ“Šå¾Œè§¸ç™¼å¼·å…‰å‹•ç•«ï¼Œé€²å…¥æœ€çµ‚ç¦®ç‰©ç‹€æ…‹
                        retryBtn.onclick = () => handleFinalAnimationTrigger(); 
                        actionArea.appendChild(retryBtn);
                        
                        // é‡è¨­ç¦®ç‰©ç›’æ¨£å¼ï¼Œæº–å‚™çµ¦ handleFinalAnimationTrigger ä½¿ç”¨ï¼Œä½†ç›®å‰ä»éš±è—
                        giftBoxVisual.style.animation = 'none';
                        giftBoxVisual.style.opacity = '1';
                        giftBoxVisual.style.transform = 'scale(1) rotate(0deg)'; 

                    }, 500); 
                    break;
                }
                
                case 14: {
                    // æœ€å¾Œç¦®ç‰© (gift5)
                    loadingSpinner.classList.add('hidden-item');
                    // currentGiftIndex æ‡‰è©²æ˜¯ 6ï¼ŒæŒ‡å‘æœ€å¾Œçš„ç¦®ç‰©
                    const finalGift = giftSequence[currentGiftIndex]; 
                    showContentCard(
                        finalGift.title,
                        finalGift.text,
                        finalGift.img,
                        'bg-amber-100/90 border-4 border-amber-400' // èƒŒæ™¯å’Œé‚Šæ¡†æ”¹ç‚ºç¥ç€è‰²
                    );

                    const finalBtn = document.createElement('button');
                    finalBtn.className = 'piggy-button bg-amber-400 hover:bg-amber-500 text-indigo-900 shadow-lg animate-pulse mt-4'; // æŒ‰éˆ•æ”¹ç‚ºæ·ºç¥ç€è‰²
                    finalBtn.textContent = finalGift.nextBtnText;
                    finalBtn.onclick = () => handleNextGiftStep(finalGift.nextState); // å°å‘æœ€çµ‚å¡ç‰‡ç‹€æ…‹ (State 15)
                    actionArea.appendChild(finalBtn);
                    break;
                }
                
                // --- æœ€çµ‚å¡ç‰‡ ---
                case 15:
                    // å¡ç‰‡é€å­—æ’­æ”¾
                    typeText(cardText);
                    break;

                default:
                    showContentCard('éŠæˆ²ç‹€æ…‹éŒ¯èª¤ï¼Œè«‹é‡æ–°æ•´ç†ã€‚', 'è«‹å¾é ­é–‹å§‹ã€‚');
                    break;
            }
        }

        /**
         * è™•ç†ã€Œå†é–‹ä¸€æ¬¡ï¼ã€æŒ‰éˆ•ï¼Œè§¸ç™¼æœ€çµ‚å‹•ç•«
         */
        function handleFinalAnimationTrigger() {
            actionArea.innerHTML = '';
            contentDisplay.innerHTML = '';
            message.textContent = 'âš¡ï¸ ç™¼å‡ºå¼·å…‰ï¼æœ€å¤§çå³å°‡ç¾èº«... âš¡ï¸';
            
            // ç¢ºä¿ giftBoxVisual å®Œå…¨é‡ç½®ä¸¦é¡¯ç¤º
            giftBoxVisual.classList.remove('hidden-item');
            giftBoxVisual.src = "gift1.jpg"; // ç¢ºä¿æ˜¯åŸå§‹ç¦®ç‰©ç›’
            giftBoxVisual.style.animation = 'none';
            giftBoxVisual.style.transform = 'scale(1) rotate(0deg)'; // é¡¯å¼é‡è¨­ transform
            giftBoxVisual.style.opacity = '1';
            void giftBoxVisual.offsetWidth; // å¼·åˆ¶ç€è¦½å™¨é‡ç¹ªï¼Œç¢ºä¿æ¨£å¼ç”Ÿæ•ˆ
            
            // è®“æ•´å€‹å®¹å™¨ç™¼å‡ºå¼·å…‰
            const container = document.getElementById('game-container');
            container.style.animation = 'strongGlow 3s ease-in-out forwards';
            
            // ç¦®ç‰©ç›’ç™¼å…‰å¾Œæ¶ˆå¤± (æ¨¡æ“¬æ‰“é–‹)
            giftBoxVisual.style.animation = 'openAndGlow 0.5s forwards'; 

            loadingSpinner.classList.remove('hidden-item');
            
            setTimeout(() => {
                container.style.animation = 'none'; // ç§»é™¤å¼·å…‰
                currentGiftIndex++; // å°‡ç´¢å¼•å¾çˆ†ç‚¸ç¦®ç‰© (5) æ¨é€²åˆ°æœ€çµ‚ç¦®ç‰© (6)
                updateGame(14); // ç›´æ¥é€²å…¥æœ€çµ‚ç¦®ç‰©ç‹€æ…‹ (State 14)
            }, 3000); // å¼·å…‰å‹•ç•«æŒçºŒ 3 ç§’
        }
        
        // é é¢è¼‰å…¥æ™‚å•Ÿå‹•éŠæˆ²
        window.onload = () => updateGame(0);
        
    </script>
</body>
</html>